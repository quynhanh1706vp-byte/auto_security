/* VSP_BUNDLE_TABS5_SAFE_V2 - prevents JS crash, loads core modules in-order */
(function(){
  'use strict';

/* P65_DOM_ALIAS_CONTAINERS_V1 */
(function(){
try{
var host=document.getElementById('vsp5_root')||document.getElementById('vsp-dashboard-main')||document.body;
var ids=["vsp-health-badge", "vsp-releases-fab", "vsp-ui-ok-badge", "vspLatestRid", "vspTabs", "vspTabs4ToastV2"];
for(var i=0;i<ids.length;i++){
  var id=ids[i];
  if(!id) continue;
  if(document.getElementById(id)) continue;
  var d=document.createElement('div'); d.id=id;
  d.style.cssText='display:contents';
  host.appendChild(d);
}
}catch(_){}}
)();


/* P64B_OVERLAY_LOADER_V1 */
(function(){
  try{
    if (window.__VSP_P64B_OVERLAY_LOADED) return;
    window.__VSP_P64B_OVERLAY_LOADED = true;
    var sc = document.createElement('script');
    sc.src = '/static/js/vsp_runtime_error_overlay_v1.js?v=' + Date.now();
    sc.defer = true;
    (document.head || document.documentElement).appendChild(sc);
  }catch(_){}
})();


  const scripts = [
    "/static/js/vsp_tabs3_common_v3.js",
    "/static/js/vsp_topbar_commercial_v1.js",
    "/static/js/vsp_ui_shell_v1.js",
    "/static/js/vsp_cio_shell_apply_v1.js",
    "/static/js/vsp_polish_apply_p2_safe_v2.js",
    "/static/js/vsp_fetch_guard_rid_v1.js",
    "/static/js/vsp_rid_persist_patch_v1.js",
    "/static/js/vsp_rid_switch_refresh_all_v1.js",
    "/static/js/vsp_tabs4_autorid_v1.js"
  ];

  function already(src){
    return !!document.querySelector('script[src="' + src + '"]');
  }
  function loadOne(src){
    return new Promise((resolve) => {
      if (already(src)) return resolve({src, ok:true, cached:true});
      const s = document.createElement("script");
      s.src = src;
      s.async = false;
      s.onload = () => resolve({src, ok:true});
      s.onerror = () => resolve({src, ok:false});
      (document.head || document.documentElement).appendChild(s);
    });
  }

  (async function(){
    const results = [];
    for (const src of scripts){
      try { results.push(await loadOne(src)); }
      catch(e){ results.push({src, ok:false, err:String(e||"")}); }
    }
    try { console.debug("[VSP] bundle tabs5 loaded", results); } catch(_){}
    window.__VSP_BUNDLE_TABS5_SAFE_V2 = { ok:true, results };
  })();
})();


/* VSP_P68_FORCE_LOAD_LUXE_V1
 * Ensure /vsp5 always loads dashboard luxe JS (prevents blank dashboard due to missing script include)
 */
(function(){
  function ensureLuxe(){
    try{
      if (window.__VSP_P68_LUXE_DONE) return;
      window.__VSP_P68_LUXE_DONE = true;

      // only do this if dashboard container exists
      var host = document.getElementById("vsp-dashboard-main") || document.getElementById("vsp5_root");
      if (!host) return;

      // already present?
      var scripts = Array.prototype.slice.call(document.scripts || []);
      var has = scripts.some(function(sc){ return (sc && sc.src && sc.src.indexOf("vsp_dashboard_luxe_v1.js") >= 0); });
      if (has) { console.info("[VSP] luxe already present (P68)"); return; }

      var sc = document.createElement("script");
      sc.src = "/static/js/vsp_dashboard_luxe_v1.js?v=" + Date.now();
      sc.async = true;
      sc.onload = function(){ console.info("[VSP] luxe loaded (P68)"); };
      sc.onerror = function(e){ console.warn("[VSP] luxe load FAILED (P68)", e); };
      document.head.appendChild(sc);
    }catch(e){}
  }
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", ensureLuxe, {once:true});
  } else {
    ensureLuxe();
  }
})();


/* VSP_P72B_LOAD_DASHBOARD_MAIN_V1 */
(function(){
  try{
    var scripts = Array.prototype.slice.call(document.scripts || []);
    var has = scripts.some(function(sc){ return sc && sc.src && sc.src.indexOf("vsp_dashboard_main_v1.js")>=0; });
    if (has) return;

    var sc = document.createElement("script");
    sc.src = "/static/js/vsp_dashboard_main_v1.js?v=" + Date.now();
    sc.async = true;
    sc.onload = function(){ console.info("[VSP] dashboard_main_v1 loaded (P72B)"); };
    sc.onerror = function(e){ console.warn("[VSP] dashboard_main_v1 load FAILED (P72B)", e); };
    document.head.appendChild(sc);
  }catch(e){}
})();

