/**
 * VSP console patch v1
 * Mục tiêu: chặn mọi log / warning chứa "[VSP_RUNS_UI_v1]"
 * để không còn rác console từ legacy stub cũ.
 */

(function () {
  'use strict';

  var origWarn = console.warn;
  var origLog  = console.log;

  function shouldMute(msg) {
    if (!msg || typeof msg !== 'string') return false;
    return msg.indexOf('[VSP_RUNS_UI_v1]') !== -1 ||
           msg.indexOf('tbody#vsp-runs-tbody') !== -1;
  }

  console.warn = function () {
    if (arguments.length > 0 && shouldMute(arguments[0])) {
      // Nuốt luôn log cũ
      return;
    }
    return origWarn.apply(console, arguments);
  };

  console.log = function () {
    if (arguments.length > 0 && shouldMute(arguments[0])) {
      return;
    }
    return origLog.apply(console, arguments);
  };

  origLog('[VSP_CONSOLE_PATCH] Installed console filter for legacy RUNS_UI_v1 logs.');
})();


// VSP_SETTINGS_AUTOBIND_v1
(function() {
  const LOG = "[VSP_SETTINGS_BIND]";
  function bindVspSettingsTab() {
    if (!window.vspInitSettingsTab) {
      console.warn(LOG, "vspInitSettingsTab not found on window.");
      return;
    }
    const btns = Array.from(document.querySelectorAll(
      "[data-vsp-tab='settings'], [data-vsp-target='#tab-settings'], [data-vsp-id='settings']"
    ));
    if (!btns.length) {
      console.warn(LOG, "No Settings tab button found.");
      return;
    }
    btns.forEach(btn => {
      if (btn.dataset.vspSettingsBound === "1") return;
      btn.addEventListener("click", () => {
        try {
          window.vspInitSettingsTab();
        } catch (e) {
          console.error(LOG, "Error in vspInitSettingsTab", e);
        }
      });
      btn.dataset.vspSettingsBound = "1";
    });
    console.log(LOG, "bound", btns.length, "Settings tab buttons.");
  }
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", bindVspSettingsTab);
  } else {
    bindVspSettingsTab();
  }
})();
