<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>SECURITY_BUNDLE – VersaSecure Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Main CSS mới -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/vsp_main.css') }}">

  <!-- Chart.js cho biểu đồ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="vsp-body">
<div class="vsp-root">
  <!-- SIDEBAR -->
  <aside class="vsp-sidebar">
    <div class="vsp-logo">
      <div class="vsp-logo-icon">SB</div>
      <div class="vsp-logo-text">
        <span class="vsp-logo-title">SECURITY_BUNDLE</span>
        <span class="vsp-logo-sub">Enterprise Security Profile EXT+</span>
      </div>
    </div>

    <!-- Profile box như UI cũ -->
    <div class="vsp-profile-card">
      <div class="vsp-profile-title">PROFILE</div>
      <div class="vsp-profile-main">EXT – Multi-tool offline</div>
      <div class="vsp-profile-run">
        Last run: <span id="sidebar-last-run">RUN_gileaks_20251115_172343</span>
      </div>
    </div>

    <!-- MENU 5 TAB -->
    <nav class="vsp-nav">
      <button class="vsp-nav-item active" data-tab-target="tab-dashboard">
        <span class="vsp-nav-dot"></span>
        <span>Dashboard</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-runs">
        <span class="vsp-nav-dot"></span>
        <span>Runs &amp; Reports</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-data">
        <span class="vsp-nav-dot"></span>
        <span>Data Source</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-settings">
        <span class="vsp-nav-dot"></span>
        <span>Settings</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-rules">
        <span class="vsp-nav-dot"></span>
        <span>Rule Overrides</span>
      </button>
    </nav>

    <div class="vsp-sidebar-footer">
      <div class="vsp-badge-profile">DEPSECOPS – ISO 27001 | CIO level</div>
      <div class="vsp-badge-build">Build: 2025 – Commercial</div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="vsp-main">
    <!-- HEADER TOP -->
    <header class="vsp-header">
      <div class="vsp-header-left">
        <div class="vsp-header-title">
          <h1>Security posture – latest run</h1>
          <p class="vsp-header-sub">
            Multi-tool offline scan (Semgrep, Gitleaks, Trivy, Grype, KICS, CodeQL…) – tất cả findings đã normalize về 6 mức: CRITICAL / HIGH / MEDIUM / LOW / INFO / TRACE.
          </p>
        </div>
      </div>
      <div class="vsp-header-right">
        <div class="vsp-header-run-meta">
          <span class="vsp-chip vsp-chip-green">EXT+ profile</span>
          <span class="vsp-chip vsp-chip-outline">Mode: offline cached DB</span>
          <span class="vsp-chip vsp-chip-outline">Tools: 6 / 7</span>
        </div>
        <button class="vsp-btn-primary">
          Run scan
        </button>
      </div>
    </header>

    <!-- ==== TAB 1: DASHBOARD ==== -->
    <section id="tab-dashboard" class="vsp-tab active">
      <!-- Target input (Thư mục / URL cần scan) -->
      <div class="vsp-card vsp-card-target">
        <div class="vsp-target-label">Thư mục / URL cần scan</div>
        <div class="vsp-target-row">
          <input class="vsp-input vsp-input-wide" id="input-target" placeholder="VD: /home/test/Data/khach6 hoặc https://app.example.com">
          <button class="vsp-btn-secondary">Load last run</button>
        </div>
        <div class="vsp-target-meta">
          <span>SRC (source code): <span id="meta-src-path">/home/test/Data/CODE_20110225_P</span></span>
          <span>Target URL: <span id="meta-target-url">https://app.example.com</span></span>
          <span>Tools enabled: <span id="meta-tools-enabled">6 / 7</span></span>
        </div>
      </div>

      <!-- Summary strip giống dòng “SECURITY_BUNDLE – Multi-tool offline scan…” -->
      <div class="vsp-card vsp-card-strip">
        <div class="vsp-strip-title">
          SECURITY_BUNDLE – Enterprise Security Profile EXT+ – Multi-tool offline scan (Semgrep, Gitleaks, Trivy, Grype, KICS, …)
        </div>
        <div class="vsp-strip-sub">
          SRC: <span id="strip-src">/home/test/Data/CODE_20110225_P</span> |
          Target: <span id="strip-target">https://app.example.com</span> |
          LAST RUN: <span id="strip-last-run">RUN_gitleaks_20251115_172343</span>
        </div>
      </div>

      <!-- KPI 6 mức severity -->
      <div class="vsp-grid vsp-grid-6">
        <div class="vsp-card vsp-card-kpi">
          <div class="vsp-kpi-label">Total findings (all tools)</div>
          <div class="vsp-kpi-value" id="kpi-total">0</div>
          <div class="vsp-kpi-sub">All buckets</div>
        </div>
        <div class="vsp-card vsp-card-kpi vsp-kpi-critical-card">
          <div class="vsp-kpi-label">CRITICAL</div>
          <div class="vsp-kpi-value vsp-kpi-critical" id="kpi-critical">0</div>
          <div class="vsp-kpi-sub">Severity bucket</div>
        </div>
        <div class="vsp-card vsp-card-kpi vsp-kpi-high-card">
          <div class="vsp-kpi-label">HIGH</div>
          <div class="vsp-kpi-value vsp-kpi-high" id="kpi-high">0</div>
          <div class="vsp-kpi-sub">Severity bucket</div>
        </div>
        <div class="vsp-card vsp-card-kpi vsp-kpi-medium-card">
          <div class="vsp-kpi-label">MEDIUM</div>
          <div class="vsp-kpi-value" id="kpi-medium">0</div>
          <div class="vsp-kpi-sub">Noise / medium bucket</div>
        </div>
        <div class="vsp-card vsp-card-kpi vsp-kpi-low-card">
          <div class="vsp-kpi-label">LOW</div>
          <div class="vsp-kpi-value" id="kpi-low">0</div>
          <div class="vsp-kpi-sub">Best-practice findings</div>
        </div>
        <div class="vsp-card vsp-card-kpi vsp-kpi-info-card">
          <div class="vsp-kpi-label">INFO / TRACE</div>
          <div class="vsp-kpi-value" id="kpi-info-trace">0</div>
          <div class="vsp-kpi-sub">Cosmetic / trace-only</div>
        </div>
      </div>

      <!-- Donut + Top risk findings -->
      <div class="vsp-grid vsp-grid-2">
        <div class="vsp-card vsp-card-chart">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Severity buckets – last run</span>
            <span class="vsp-card-sub">Interactive overview (CRITICAL → TRACE)</span>
          </div>
          <div class="vsp-chart-wrapper">
            <canvas id="chartSeverity"></canvas>
          </div>
        </div>
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Top risk findings</span>
            <span class="vsp-card-sub">Highest impact items để triage trước</span>
          </div>
          <div class="vsp-table-wrapper">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Severity</th>
                <th>Rule / ID / Location</th>
                <th>Tool</th>
              </tr>
              </thead>
              <tbody id="table-top-risk">
              <tr>
                <td><span class="vsp-pill sev-critical">CRITICAL</span></td>
                <td>generic_auth_token_leak – src/runner.py:76</td>
                <td>Semgrep</td>
              </tr>
              <tr>
                <td><span class="vsp-pill sev-high">HIGH</span></td>
                <td>Secret exposed – config.py (GITLAB_TOKEN)</td>
                <td>Gitleaks</td>
              </tr>
              <tr>
                <td><span class="vsp-pill sev-medium">MEDIUM</span></td>
                <td>HTTP only on Docker compose v3.13.4</td>
                <td>Trivy FS</td>
              </tr>
              <tr>
                <td><span class="vsp-pill sev-medium">MEDIUM</span></td>
                <td>Unpinned version – requirements.txt:12</td>
                <td>Semgrep</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- By tool + Trend -->
      <div class="vsp-grid vsp-grid-2">
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">By tool – severity buckets</span>
            <span class="vsp-card-sub">Counts per tool, last run (giống bảng UI cũ)</span>
          </div>
          <div class="vsp-table-wrapper vsp-table-wrapper-tall">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Tool</th>
                <th>C</th>
                <th>H</th>
                <th>M</th>
                <th>L</th>
                <th>Info</th>
                <th>Trace</th>
                <th>Total</th>
              </tr>
              </thead>
              <tbody id="table-by-tool">
              <tr>
                <td>Semgrep</td>
                <td>0</td><td>346</td><td>8851</td><td>0</td><td>0</td><td>0</td><td>8897</td>
              </tr>
              <tr>
                <td>Gitleaks</td>
                <td>0</td><td>26</td><td>0</td><td>0</td><td>0</td><td>0</td><td>26</td>
              </tr>
              <tr>
                <td>Grype</td>
                <td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>2</td>
              </tr>
              <tr>
                <td>Trivy FS</td>
                <td>0</td><td>8</td><td>12</td><td>0</td><td>0</td><td>0</td><td>20</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="vsp-card vsp-card-chart">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Trend – last runs</span>
            <span class="vsp-card-sub">Total findings over time (RUN_01 → RUN_10)</span>
          </div>
          <div class="vsp-chart-wrapper">
            <canvas id="chartTrend"></canvas>
          </div>
        </div>
      </div>

      <!-- Top noisy paths – rút gọn -->
      <div class="vsp-grid vsp-grid-1">
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Top noisy paths</span>
            <span class="vsp-card-sub">Medium / Low / Info / Trace (demo giống UI cũ)</span>
          </div>
          <div class="vsp-table-wrapper">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Path</th>
                <th>M</th>
                <th>L</th>
                <th>Info</th>
                <th>Trace</th>
                <th>Total</th>
              </tr>
              </thead>
              <tbody id="table-noisy-paths">
              <tr>
                <td>tests/</td><td>4200</td><td>10</td><td>0</td><td>0</td><td>4210</td>
              </tr>
              <tr>
                <td>examples/</td><td>650</td><td>45</td><td>0</td><td>0</td><td>695</td>
              </tr>
              <tr>
                <td>docs/</td><td>90</td><td>25</td><td>0</td><td>0</td><td>115</td>
              </tr>
              <tr>
                <td>scripts/</td><td>40</td><td>10</td><td>0</td><td>0</td><td>50</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ==== TAB 2: RUNS & REPORTS ==== -->
    <section id="tab-runs" class="vsp-tab">
      <div class="vsp-grid vsp-grid-1">
        <!-- Trend lớn chuyển sang tab này luôn cho hợp lý -->
        <div class="vsp-card vsp-card-chart">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Trend – all runs</span>
            <span class="vsp-card-sub">Tổng findings theo thời gian (từ run_index.json)</span>
          </div>
          <div class="vsp-chart-wrapper">
            <canvas id="chartRunsTrend"></canvas>
          </div>
        </div>

        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Run history</span>
            <span class="vsp-card-sub">Mỗi dòng là 1 lần scan (SRC/URL)</span>
          </div>
          <div class="vsp-table-toolbar">
            <div class="vsp-table-filters">
              <input class="vsp-input vsp-input-medium" placeholder="Filter by source / URL / run id...">
            </div>
            <div class="vsp-table-actions">
              <button class="vsp-btn-secondary">Export run index</button>
            </div>
          </div>
          <div class="vsp-table-wrapper vsp-table-wrapper-tall">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Run ID</th>
                <th>Source / URL</th>
                <th>Profile</th>
                <th>CRIT</th>
                <th>HIGH</th>
                <th>MED</th>
                <th>LOW</th>
                <th>INFO</th>
                <th>TRACE</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
              </thead>
              <tbody id="runs-table-body">
              <tr>
                <td>RUN_01</td>
                <td>/home/test/Data/CODE_20110225_P</td>
                <td>EXT+</td>
                <td>0</td><td>10</td><td>200</td><td>300</td><td>50</td><td>10</td>
                <td><span class="vsp-badge-status success">Completed</span></td>
                <td>
                  <button class="vsp-link-button">View</button>
                  <button class="vsp-link-button">Export</button>
                </td>
              </tr>
              <tr>
                <td>RUN_10</td>
                <td>https://app.example.com</td>
                <td>EXT+</td>
                <td>1</td><td>25</td><td>320</td><td>410</td><td>60</td><td>15</td>
                <td><span class="vsp-badge-status success">Completed</span></td>
                <td>
                  <button class="vsp-link-button">View</button>
                  <button class="vsp-link-button">Export</button>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ==== TAB 3: DATA SOURCE ==== -->
    <section id="tab-data" class="vsp-tab">
      <div class="vsp-grid vsp-grid-3-1">
        <!-- Bảng unified findings -->
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Unified findings (6 mức severity)</span>
            <span class="vsp-card-sub">Đọc từ report/findings_unified_v2.json</span>
          </div>
          <div class="vsp-table-toolbar">
            <div class="vsp-table-filters">
              <select class="vsp-input vsp-input-small">
                <option value="">Severity: All</option>
                <option>CRITICAL</option>
                <option>HIGH</option>
                <option>MEDIUM</option>
                <option>LOW</option>
                <option>INFO</option>
                <option>TRACE</option>
              </select>
              <select class="vsp-input vsp-input-small">
                <option value="">Tool: All</option>
                <option>Gitleaks</option>
                <option>Semgrep</option>
                <option>Bandit</option>
                <option>TrivyFS</option>
                <option>Grype</option>
                <option>KICS</option>
                <option>CodeQL</option>
              </select>
              <input class="vsp-input vsp-input-medium" placeholder="Search file / rule / message / CWE...">
            </div>
            <div class="vsp-table-actions">
              <button class="vsp-btn-secondary">Export CSV</button>
            </div>
          </div>
          <div class="vsp-table-wrapper vsp-table-wrapper-tall">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Severity</th>
                <th>Tool</th>
                <th>File</th>
                <th>Line</th>
                <th>Rule ID</th>
                <th>Message</th>
                <th>CWE</th>
              </tr>
              </thead>
              <tbody id="data-table-body">
              <tr>
                <td><span class="vsp-pill sev-high">HIGH</span></td>
                <td>Semgrep</td>
                <td>src/app/auth/login.py</td>
                <td>123</td>
                <td>python.jwt.insecure-decode</td>
                <td>JWT is decoded without verifying the signature</td>
                <td>CWE-347</td>
              </tr>
              <tr>
                <td><span class="vsp-pill sev-medium">MEDIUM</span></td>
                <td>KICS</td>
                <td>infra/terraform/main.tf</td>
                <td>45</td>
                <td>aws.public_sg</td>
                <td>Security group allows 0.0.0.0/0</td>
                <td>CWE-284</td>
              </tr>
              </tbody>
            </table>
          </div>

          <!-- By tool table để giữ lại nội dung cũ -->
          <div class="vsp-card-subtitle">By tool – severity buckets (full)</div>
          <div class="vsp-table-wrapper vsp-table-wrapper-tall">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Tool</th>
                <th>CRITICAL</th>
                <th>HIGH</th>
                <th>MEDIUM</th>
                <th>LOW</th>
                <th>INFO</th>
                <th>TRACE</th>
                <th>Total</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>Gitleaks</td><td>0</td><td>1008</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1008</td>
              </tr>
              <tr>
                <td>Semgrep</td><td>0</td><td>80</td><td>300</td><td>400</td><td>150</td><td>30</td><td>960</td>
              </tr>
              <tr>
                <td>Bandit</td><td>0</td><td>10</td><td>40</td><td>50</td><td>10</td><td>5</td><td>115</td>
              </tr>
              </tbody>
            </table>
          </div>

          <!-- Top noisy paths full -->
          <div class="vsp-card-subtitle">Top noisy paths – full list</div>
          <div class="vsp-table-wrapper vsp-table-wrapper-tall">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Path</th>
                <th>M</th>
                <th>L</th>
                <th>Info</th>
                <th>Trace</th>
                <th>Total</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>tests/</td><td>4200</td><td>10</td><td>0</td><td>0</td><td>4210</td>
              </tr>
              <tr>
                <td>examples/</td><td>650</td><td>45</td><td>0</td><td>0</td><td>695</td>
              </tr>
              <tr>
                <td>docs/</td><td>90</td><td>25</td><td>0</td><td>0</td><td>115</td>
              </tr>
              <tr>
                <td>scripts/</td><td>40</td><td>10</td><td>0</td><td>0</td><td>50</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Mini charts bên phải -->
        <div class="vsp-card vsp-card-sidecharts">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Data insights</span>
          </div>
          <div class="vsp-chart-wrapper mini">
            <span class="vsp-sidechart-label">By severity</span>
            <canvas id="chartDataSeverity"></canvas>
          </div>
          <div class="vsp-chart-wrapper mini">
            <span class="vsp-sidechart-label">By tool</span>
            <canvas id="chartDataTool"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- ==== TAB 4: SETTINGS ==== -->
    <section id="tab-settings" class="vsp-tab">
      <div class="vsp-grid vsp-grid-3">
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">General</span>
          </div>
          <div class="vsp-form-group">
            <label>Default profile</label>
            <select class="vsp-input">
              <option selected>EXT+ (Enterprise)</option>
              <option>FAST (Smoke)</option>
              <option>AGGR (Deep)</option>
            </select>
          </div>
          <div class="vsp-form-group">
            <label>Base source path</label>
            <input class="vsp-input" value="/home/test/Data">
          </div>
          <div class="vsp-form-group">
            <label>Max findings hiển thị trên UI</label>
            <input class="vsp-input" type="number" value="5000">
          </div>
        </div>

        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Tool stack</span>
          </div>
          <div class="vsp-toggle-row">
            <span>Gitleaks (Secrets)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>Semgrep (SAST)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>Bandit (Python SAST)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>TrivyFS / Grype (Vuln / SBOM)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>KICS (IaC)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>CodeQL (Advanced SAST)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
        </div>

        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Export &amp; reporting</span>
          </div>
          <div class="vsp-form-group">
            <label>Default export format</label>
            <select class="vsp-input">
              <option>HTML</option>
              <option>PDF</option>
              <option selected>CSV</option>
              <option>SARIF</option>
            </select>
          </div>
          <div class="vsp-form-group">
            <label>Include ISO 27001 mapping</label>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-form-group">
            <label>Include OWASP / ASVS mapping</label>
            <label class="vsp-switch">
              <input type="checkbox" checked><span class="vsp-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- ==== TAB 5: RULE OVERRIDES ==== -->
    <section id="tab-rules" class="vsp-tab">
      <div class="vsp-grid vsp-grid-3-2">
        <!-- Rule list -->
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Rule sets</span>
            <span class="vsp-card-sub">Override severity / enable / disable</span>
          </div>
          <ul class="vsp-rule-list">
            <li class="active">Semgrep – websec_profile.yml</li>
            <li>Semgrep – python_secure.yml</li>
            <li>KICS – aws_cloud_profile.yml</li>
            <li>CodeQL – default-queries.yml</li>
          </ul>
        </div>

        <!-- Editor -->
        <div class="vsp-card vsp-card-editor">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Rule override editor</span>
            <span class="vsp-card-sub">YAML preview (6 mức severity: CRITICAL/HIGH/MEDIUM/LOW/INFO/TRACE)</span>
          </div>
          <textarea class="vsp-editor" spellcheck="false">
rules:
  - id: python.jwt.insecure-decode
    message: "JWT is decoded without verifying the signature"
    severity: HIGH   # override đây
    metadata:
      cwe: CWE-347
      owasp: A02:2021
      iso27001: A.14.2.5

  - id: sql.injection.generic
    severity: CRITICAL
    metadata:
      cwe: CWE-89
      owasp: A03:2021
          </textarea>
          <div class="vsp-editor-actions">
            <button class="vsp-btn-secondary">Validate YAML</button>
            <button class="vsp-btn-primary">Apply override</button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Main JS -->
<script src="{{ url_for('static', filename='js/vsp_main.js') }}"></script>
</body>
</html>
