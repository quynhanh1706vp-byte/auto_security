<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>VersaSecure Platform (VSP)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Main VSP CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/vsp_main.css') }}">

  <!-- Chart.js CDN (dùng cho Dashboard & Data) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* ==========================================
     VSP – Dashboard compact FINAL
     Mục tiêu:
       - Bỏ min-height / space-between gây khoảng trống.
       - Ép các khối dồn lên trên, giảm cuộn dọc.
     ========================================== */

  /* Bản thân tab-dashboard không kéo dài cả viewport */
  #tab-dashboard {
    min-height: auto !important;
    padding-bottom: 16px !important;
    margin-bottom: 0 !important;
  }

  /* Mọi flex bên trong có xu hướng space-between -> dồn lên trên */
  #tab-dashboard [style*="space-between"] {
    justify-content: flex-start !important;
  }

  /* Các layout wrapper chính bên trong tab-dashboard nếu là flex */
  #tab-dashboard .vsp-section,
  #tab-dashboard .vsp-row,
  #tab-dashboard .vsp-grid,
  #tab-dashboard .row {
    justify-content: flex-start !important;
    align-items: flex-start !important;
  }

  /* Giảm chiều cao chart để tổng chiều cao panel nhỏ lại */
  #tab-dashboard canvas {
    max-height: 260px !important;
  }

  /* Giảm gap dọc giữa các section lớn */
  #tab-dashboard .vsp-section {
    margin-bottom: 16px !important;
  }

  /* Bảng phía dưới không cần thêm padding dư */
  #tab-dashboard table {
    margin-bottom: 8px !important;
  }
</style>
</head>
<body class="vsp-body">
<div class="vsp-root">
  <!-- Sidebar -->
  <aside class="vsp-sidebar">
    <div class="vsp-logo">
      <div class="vsp-logo-icon">V</div>
      <div class="vsp-logo-text">
        <span class="vsp-logo-title">VersaSecure</span>
        <span class="vsp-logo-sub">Enterprise Security Profile (EXT+)</span>
      </div>
    </div>

    <nav class="vsp-nav">
      <button class="vsp-nav-item active" data-tab-target="tab-dashboard">
        <span class="vsp-nav-dot"></span>
        <span>Dashboard</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-runs">
        <span class="vsp-nav-dot"></span>
        <span>Runs & Reports</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-data">
        <span class="vsp-nav-dot"></span>
        <span>Data Source</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-settings">
        <span class="vsp-nav-dot"></span>
        <span>Settings</span>
      </button>
      <button class="vsp-nav-item" data-tab-target="tab-rules">
        <span class="vsp-nav-dot"></span>
        <span>Rule Overrides</span>
      </button>
    </nav>

    <div class="vsp-sidebar-footer">
      <div class="vsp-badge-profile">Profile: EXT+</div>
      <div class="vsp-badge-build">Build: 2025 Commercial</div>
    </div>
  </aside>

  <!-- Main content -->
  <main class="vsp-main">
    <!-- Top header bar -->
    <header class="vsp-header">
      <div class="vsp-header-left">
        <div class="vsp-header-title">
          <h1>Security Posture Overview</h1>
<!-- [VSP][DASH_V3] KPI row bound to /api/vsp/dashboard_v3 -->
<div id="vsp-dashboard-kpis-v3" class="vsp-dashboard-kpis-v3" style="margin-top: 16px; margin-bottom: 24px;">
  <div style="display: grid; grid-template-columns: minmax(0, 2.5fr) minmax(0, 1.5fr) minmax(0, 2fr); gap: 16px;">
    <!-- Card 1: Total + 6 buckets -->
    <div class="vsp-card vsp-card-kpi">
      <div class="vsp-kpi-header">Unified Findings</div>
      <div style="font-size: 32px; font-weight: 700; margin-top: 4px;">
        <span id="vsp-kpi-total">-</span>
      </div>
      <div style="font-size: 13px; opacity: 0.85; margin-top: 8px; line-height: 1.6;">
        <span>Critical:</span> <span id="vsp-kpi-critical">-</span> ·
        <span>High:</span> <span id="vsp-kpi-high">-</span> ·
        <span>Medium:</span> <span id="vsp-kpi-medium">-</span> ·
        <span>Low:</span> <span id="vsp-kpi-low">-</span> ·
        <span>Info:</span> <span id="vsp-kpi-info">-</span> ·
        <span>Trace:</span> <span id="vsp-kpi-trace">-</span>
      </div>
    </div>

    <!-- Card 2: Security Score -->
    <div class="vsp-card vsp-card-kpi">
      <div class="vsp-kpi-header">Security Score</div>
      <div style="font-size: 32px; font-weight: 700; margin-top: 4px;">
        <span id="vsp-kpi-security-score">-</span>
      </div>
      <div style="font-size: 13px; opacity: 0.85; margin-top: 8px;">
        0–100 (càng cao càng tốt)
      </div>
    </div>

    <!-- Card 3: Top Tool / CWE / Module -->
    <div class="vsp-card vsp-card-kpi">
      <div class="vsp-kpi-header">Top Risk & Hotspot</div>
      <div style="font-size: 13px; opacity: 0.85; margin-top: 4px; line-height: 1.6;">
        <div><strong>Top risky tool:</strong> <span id="vsp-kpi-top-tool">-</span></div>
        <div><strong>Top CWE:</strong> <span id="vsp-kpi-top-cwe">-</span></div>
        <div><strong>Top module:</strong> <span id="vsp-kpi-top-module">-</span></div>
      </div>
    </div>
  </div>
</div>

<script>
// [VSP][DASH_V3] Inline binder cho dashboard_v3
(function() {
  function bindDashboardV3() {
    try {
      if (!window.fetch) {
        console.warn("[VSP][DASH_V3] Trình duyệt không hỗ trợ fetch.");
        return;
      }

      fetch("/api/vsp/dashboard_v3")
        .then(function(res) { return res.json(); })
        .then(function(payload) {
          if (!payload) {
            console.warn("[VSP][DASH_V3] payload rỗng.");
            return;
          }

          var sev = payload.by_severity || payload.severity || {};
          var total = Number(payload.total_findings || 0);

          var crit  = Number(sev.CRITICAL || 0);
          var high  = Number(sev.HIGH     || 0);
          var med   = Number(sev.MEDIUM   || 0);
          var low   = Number(sev.LOW      || 0);
          var info  = Number(sev.INFO     || 0);
          var trace = Number(sev.TRACE    || 0);

          var score = (payload.security_score != null)
            ? Number(payload.security_score)
            : null;

          var topTool   = payload.top_risky_tool || "-";
          var topCwe    = payload.top_cwe        || "-";
          var topModule = payload.top_module     || "-";

          function setText(id, val) {
            var el = document.getElementById(id);
            if (el) el.textContent = val;
          }

          // Total + 6 bucket
          setText("vsp-kpi-total",        String(total));
          setText("vsp-kpi-critical",     String(crit));
          setText("vsp-kpi-high",         String(high));
          setText("vsp-kpi-medium",       String(med));
          setText("vsp-kpi-low",          String(low));
          setText("vsp-kpi-info",         String(info));
          setText("vsp-kpi-trace",        String(trace));

          // Score + top_x
          if (score !== null && !isNaN(score)) {
            setText("vsp-kpi-security-score", score.toFixed(1));
          }

          setText("vsp-kpi-top-tool",   topTool);
          setText("vsp-kpi-top-cwe",    topCwe);
          setText("vsp-kpi-top-module", topModule);

          console.log("[VSP][DASH_V3] Bind dashboard_v3 OK:", {
            total: total,
            sev: {crit: crit, high: high, med: med, low: low, info: info, trace: trace},
            score: score,
            topTool: topTool,
            topCwe: topCwe,
            topModule: topModule
          });
        })
        .catch(function(err) {
          console.error("[VSP][DASH_V3] Lỗi fetch /api/vsp/dashboard_v3:", err);
        });
    } catch (e) {
      console.error("[VSP][DASH_V3] Exception:", e);
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", bindDashboardV3);
  } else {
    bindDashboardV3();
  }
})();
</script>

          <p class="vsp-header-sub">
            Unified findings from 7 tools – normalized into 6 severity levels (CRITICAL → TRACE)
          </p>
        </div>
      </div>
      <div class="vsp-header-right">
        <div class="vsp-header-run-meta">
          <span class="vsp-chip vsp-chip-green">Latest Run</span>
          <span class="vsp-chip vsp-chip-outline">Profile: EXT+</span>
          <span class="vsp-chip vsp-chip-outline">Tools: 7/7</span>
        </div>
        <button class="vsp-btn-primary">
          Run New Scan
        </button>
      </div>
    </header>

    <!-- TAB 1: Dashboard -->
    <section id="tab-dashboard" class="vsp-tab active">
    <!-- VSP DASHBOARD NEW LAYOUT v1 (full 10 KPI + charts + tables) -->
    <div class="vsp-dashboard-new">
      <!-- KPI ROWS -->
      <div class="vsp-kpi-row vsp-kpi-row-top">
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Total Findings</div>
<div class="vsp-kpi-value" id="vsp-kpi-total">0</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Critical</div>
<div class="vsp-kpi-value" id="vsp-kpi-critical">0</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">High</div>
<div class="vsp-kpi-value" id="vsp-kpi-high">0</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Medium</div>
<div class="vsp-kpi-value" id="vsp-kpi-medium">0</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Low</div>
<div class="vsp-kpi-value" id="vsp-kpi-low">0</div>
        </div>
      </div>

      <div class="vsp-kpi-row vsp-kpi-row-bottom">
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Info / Trace</div>
          <div class="vsp-kpi-value">0</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Security Score</div>
<div class="vsp-kpi-value" id="vsp-kpi-security-score">-</div>
          <div class="vsp-kpi-sub">/100</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Top Risky Tool</div>
<div class="vsp-kpi-value" id="vsp-kpi-top-tool">-</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Top CWE</div>
<div class="vsp-kpi-value" id="vsp-kpi-top-cwe">-</div>
        </div>
        <div class="vsp-kpi-card">
          <div class="vsp-kpi-title">Top Module</div>
<div class="vsp-kpi-value" id="vsp-kpi-top-module">-</div>
        </div>
      </div>

      <!-- CHART ZONE -->
      <div class="vsp-charts-row">
        <div class="vsp-card chart-card" data-chart="severity_donut">
          <div class="vsp-card-header">
            <div class="vsp-card-title">Severity Distribution</div>
          </div>
          <div class="vsp-card-body">
            <canvas></canvas>
          </div>
        </div>
        <div class="vsp-card chart-card" data-chart="trend_over_time">
          <div class="vsp-card-header">
            <div class="vsp-card-title">Trend Over Time</div>
          </div>
          <div class="vsp-card-body">
            <!-- Trend line sẽ được JS vẽ sau -->
          </div>
        </div>
        <div class="vsp-card chart-card" data-chart="findings_by_tool">
          <div class="vsp-card-header">
            <div class="vsp-card-title">Findings by Tool</div>
          </div>
          <div class="vsp-card-body">
            <canvas></canvas>
          </div>
        </div>
      </div>

      <!-- FINDINGS ZONE -->
      <div class="vsp-findings-row">
        <!-- Top Findings -->
        <div class="vsp-card table-card">
          <div class="vsp-card-header">
            <div class="vsp-card-title">Top Findings</div>
          </div>
          <div class="vsp-card-body">
            <table class="vsp-table vsp-table-top-findings">
              <thead>
                <tr>
                  <th>Sev</th>
                  <th>Tool</th>
                  <th>Rule</th>
                  <th>File</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Top CVE -->
        <div class="vsp-card table-card">
          <div class="vsp-card-header">
            <div class="vsp-card-title">Top CVE</div>
          </div>
          <div class="vsp-card-body">
            <table class="vsp-table vsp-table-top-cve">
              <thead>
                <tr>
                  <th>CVE</th>
                  <th>Count</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Top Modules -->
        <div class="vsp-card table-card">
          <div class="vsp-card-header">
            <div class="vsp-card-title">Top Modules</div>
          </div>
          <div class="vsp-card-body">
            <table class="vsp-table vsp-table-top-modules">
              <thead>
                <tr>
                  <th>Module / Package</th>
                  <th>Findings</th>
                  <th>Critical/High</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- END VSP DASHBOARD NEW LAYOUT v1 -->

      <!-- KPI row -->
      <div class="vsp-grid vsp-grid-4">
        <div class="vsp-card vsp-card-kpi">
          <div class="vsp-kpi-label">Total Findings</div>
<div class="vsp-kpi-value" id="kpi-total" id="vsp-kpi-total">0</div>
          <div class="vsp-kpi-sub">Across all 6 severity levels</div>
        </div>
        <div class="vsp-card vsp-card-kpi">
          <div class="vsp-kpi-label">Critical</div>
<div class="vsp-kpi-value vsp-kpi-critical" id="kpi-critical" id="vsp-kpi-critical">0</div>
          <div class="vsp-kpi-sub">Highest risk issues</div>
        </div>
        <div class="vsp-card vsp-card-kpi">
          <div class="vsp-kpi-label">High</div>
<div class="vsp-kpi-value vsp-kpi-high" id="kpi-high" id="vsp-kpi-high">0</div>
          <div class="vsp-kpi-sub">Priority remediation</div>
        </div>
        <div class="vsp-card vsp-card-kpi">
          <div class="vsp-kpi-label">Tools Active</div>
          <div class="vsp-kpi-value" id="kpi-tools">7</div>
          <div class="vsp-kpi-sub">Gitleaks, Semgrep, Bandit, Trivy, Grype, KICS, CodeQL</div>
        </div>
      </div>

      <!-- Charts row -->
      <div class="vsp-grid vsp-grid-2">
        <div class="vsp-card vsp-card-chart">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Severity Distribution</span>
            <span class="vsp-card-sub">Normalized (CRITICAL → TRACE)</span>
          </div>
          <div class="vsp-chart-wrapper">
            <canvas id="chartSeverity"></canvas>
          </div>
        </div>
        <div class="vsp-card vsp-card-chart">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Findings by Tool</span>
            <span class="vsp-card-sub">7-tool DevSecOps stack</span>
          </div>
          <div class="vsp-chart-wrapper">
            <canvas id="chartByTool"></canvas>
          </div>
        </div>
      </div>

      <!-- Top risk files row -->
      <div class="vsp-grid vsp-grid-1">
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Top Risk Files</span>
            <span class="vsp-card-sub">Sorted by CRITICAL + HIGH + MEDIUM</span>
          </div>
          <div class="vsp-table-wrapper">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>File / Path</th>
                <th>CRIT</th>
                <th>HIGH</th>
                <th>MED</th>
                <th>LOW</th>
              </tr>
              </thead>
              <tbody id="table-top-files">
              <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Risk summary -->
      <div class="vsp-grid vsp-grid-1">
        <div class="vsp-card vsp-card-summary">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Risk Summary (AI-style narrative)</span>
          </div>
          <p id="risk-summary-text" class="vsp-summary-text">
            Waiting for data from unified summary (summary_unified_v2.json)...
          </p>
        </div>
      </div>
    </section>

    <!-- TAB 2: Runs & Reports -->
    <section id="tab-runs" class="vsp-tab">
      <div class="vsp-card">
        <div class="vsp-card-header">
          <span class="vsp-card-title">Run History</span>
          <span class="vsp-card-sub">Each run is a unified scan for a source / URL</span>
        </div>
        <div class="vsp-table-toolbar">
          <div class="vsp-table-filters">
            <input class="vsp-input" placeholder="Filter by source / URL...">
          </div>
          <div class="vsp-table-actions">
            <button class="vsp-btn-secondary">Export Run Index</button>
          </div>
        </div>
        <div class="vsp-table-wrapper">
          <table class="vsp-table">
            <thead>
            <tr>
              <th>Run ID</th>
              <th>Source / URL</th>
              <th>Profile</th>
              <th>CRIT</th>
              <th>HIGH</th>
              <th>MED</th>
              <th>LOW</th>
              <th>INFO</th>
              <th>TRACE</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody id="runs-table-body">
            <!-- JS sẽ fill từ /api sau này -->
            <tr>
              <td>URL_staging-zt_20251128_170001</td>
              <td>https://staging-zt.lab.linksafe.vn</td>
              <td>EXT+</td>
              <td>2</td>
              <td>21</td>
              <td>80</td>
              <td>40</td>
              <td>10</td>
              <td>3</td>
              <td><span class="vsp-badge-status success">Completed</span></td>
              <td>
                <button class="vsp-link-button">View</button>
                <button class="vsp-link-button">Export</button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- TAB 3: Data Source -->
    <section id="tab-data" class="vsp-tab">
      <div class="vsp-grid vsp-grid-3-1">
        <!-- Main table -->
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Unified Findings</span>
            <span class="vsp-card-sub">From report/findings_unified_v2.json</span>
          </div>
          <div class="vsp-table-toolbar">
            <div class="vsp-table-filters">
              <select class="vsp-input vsp-input-small">
                <option value="">Severity: All</option>
                <option>CRITICAL</option>
                <option>HIGH</option>
                <option>MEDIUM</option>
                <option>LOW</option>
                <option>INFO</option>
                <option>TRACE</option>
              </select>
              <select class="vsp-input vsp-input-small">
                <option value="">Tool: All</option>
                <option>Gitleaks</option>
                <option>Semgrep</option>
                <option>Bandit</option>
                <option>TrivyFS</option>
                <option>Grype</option>
                <option>KICS</option>
                <option>CodeQL</option>
              </select>
              <input class="vsp-input vsp-input-medium" placeholder="Search file / rule / message...">
            </div>
            <div class="vsp-table-actions">
              <button class="vsp-btn-secondary">Export CSV</button>
            </div>
          </div>
          <div class="vsp-table-wrapper vsp-table-wrapper-tall">
            <table class="vsp-table">
              <thead>
              <tr>
                <th>Severity</th>
                <th>Tool</th>
                <th>File</th>
                <th>Line</th>
                <th>Rule ID</th>
                <th>Message</th>
                <th>CWE</th>
              </tr>
              </thead>
              <tbody id="data-table-body">
              <!-- Sample row -->
              <tr>
                <td><span class="vsp-pill sev-high">HIGH</span></td>
                <td>Semgrep</td>
                <td>src/app/auth/login.py</td>
                <td>123</td>
                <td>python.jwt.insecure-decode</td>
                <td>JWT is decoded without verifying the signature</td>
                <td>CWE-347</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Side mini charts -->
        <div class="vsp-card vsp-card-sidecharts">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Data Insights</span>
          </div>
          <div class="vsp-chart-wrapper mini">
            <span class="vsp-sidechart-label">By severity</span>
            <canvas id="chartDataSeverity"></canvas>
          </div>
          <div class="vsp-chart-wrapper mini">
            <span class="vsp-sidechart-label">By tool</span>
            <canvas id="chartDataTool"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- TAB 4: Settings -->
    <section id="tab-settings" class="vsp-tab">
        <!-- VSP SETTINGS – RUN SCAN BLOCK -->
        <div class="vsp-card vsp-settings-run-card">
          <div class="vsp-card-header">
            <div class="vsp-card-title">
              Run scan (manual)
            </div>
            <div class="vsp-card-actions">
              <button id="vsp-settings-run-refresh" class="vsp-btn vsp-btn-ghost vsp-btn-sm">
                Refresh status
              </button>
            </div>
          </div>
          <div class="vsp-card-body vsp-settings-run-grid">
            <div class="vsp-form-group">
              <label for="vsp-settings-src" class="vsp-label">Source (code root)</label>
              <input id="vsp-settings-src"
                     type="text"
                     class="vsp-input"
                     value="/home/test/Data/CODE_20112025_P"
                     placeholder="/path/to/source or repo root">
              <div class="vsp-help-text">
                Thư mục mã nguồn sẽ được quét (SRC_IN / SCAN_SRC).
              </div>
            </div>

            <div class="vsp-form-group">
              <label for="vsp-settings-profile" class="vsp-label">Profile</label>
              <select id="vsp-settings-profile" class="vsp-select">
                <option value="EXT+">EXT+ (Full extended)</option>
                <option value="EXT">EXT</option>
                <option value="FAST">FAST</option>
              </select>
              <div class="vsp-help-text">
                Chọn profile quét (hiện tại script vẫn đang ưu tiên AGGR/EXT+).
              </div>
            </div>

            <div class="vsp-settings-run-actions">
              <button id="vsp-settings-run-btn" class="vsp-btn vsp-btn-primary">
                Run scan
              </button>
            </div>

            <div id="vsp-settings-run-status" class="vsp-settings-run-status-box">
              <!-- Status sẽ được JS (vsp_tab_settings_v1.js) đổ vào -->
            </div>
          </div>
        </div>

      <div class="vsp-grid vsp-grid-3">
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">General</span>
          </div>
          <div class="vsp-form-group">
            <label>Default Profile</label>
            <select class="vsp-input">
              <option selected>EXT+ (Enterprise)</option>
              <option>FAST (Smoke)</option>
              <option>AGGR (Deep)</option>
            </select>
          </div>
          <div class="vsp-form-group">
            <label>Max Findings per run (UI)</label>
            <input class="vsp-input" type="number" value="5000">
          </div>
        </div>

        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Tool Stack</span>
          </div>
          <div class="vsp-toggle-row">
            <span>Gitleaks (Secrets)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>Semgrep (SAST)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>Bandit (Python SAST)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>TrivyFS / Grype (Vuln / SBOM)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>KICS (IaC)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
          <div class="vsp-toggle-row">
            <span>CodeQL (Advanced SAST)</span>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
        </div>

        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Export & Reporting</span>
          </div>
          <div class="vsp-form-group">
            <label>Default export format</label>
            <select class="vsp-input">
              <option>HTML</option>
              <option>PDF</option>
              <option>CSV</option>
              <option>SARIF</option>
            </select>
          </div>
          <div class="vsp-form-group">
            <label>Include ISO 27001 mapping</label>
            <label class="vsp-switch">
              <input type="checkbox" checked>
              <span class="vsp-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- TAB 5: Rule Overrides -->
    <section id="tab-rules" class="vsp-tab">
      <div class="vsp-grid vsp-grid-3-2">
        <!-- Rule list -->
        <div class="vsp-card">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Rule Sets</span>
            <span class="vsp-card-sub">Override severity / enable / disable per rule</span>
          </div>
          <ul class="vsp-rule-list">
            <li class="active">Semgrep – websec_profile.yml</li>
            <li>Semgrep – python_secure.yml</li>
            <li>KICS – aws_cloud_profile.yml</li>
            <li>CodeQL – default-queries.yml</li>
          </ul>
        </div>

        <!-- Editor -->
        <div class="vsp-card vsp-card-editor">
          <div class="vsp-card-header">
            <span class="vsp-card-title">Rule Override Editor</span>
            <span class="vsp-card-sub">YAML preview – not saved yet</span>
          </div>
          <textarea class="vsp-editor" spellcheck="false">
rules:
  - id: python.jwt.insecure-decode
    message: "JWT is decoded without verifying the signature"
    severity: HIGH   # override here (CRITICAL/HIGH/MEDIUM/LOW/INFO/TRACE)
    metadata:
      cwe: CWE-347
      owasp: A02:2021
      iso27001: A.14.2.5
  - id: sql.injection.generic
    severity: CRITICAL
    metadata:
      cwe: CWE-89
      owasp: A03:2021
          </textarea>
          <div class="vsp-editor-actions">
            <button class="vsp-btn-secondary">Validate YAML</button>
            <button class="vsp-btn-primary">Apply Override</button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Main JS -->
<script src="{{ url_for('static', filename='js/vsp_main.js') }}"></script>
    <script src="/static/js/vsp_dashboard_live_v2.js"></script>
    <script src="/static/js/vsp_runs_live_v1.js"></script>

<script src="/static/js/vsp_tab_datasource_v1.js"></script>
<script src="/static/js/vsp_tab_settings_v1.js"></script>
<script src="/static/js/vsp_tab_overrides_v1.js"></script>
</body>
</html>