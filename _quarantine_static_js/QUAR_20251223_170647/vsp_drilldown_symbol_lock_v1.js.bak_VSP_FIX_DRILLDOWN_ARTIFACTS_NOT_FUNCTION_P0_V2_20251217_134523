/* VSP_DRILLDOWN_SYMBOL_LOCK_V1: make sure VSP_DASH_DRILLDOWN_ARTIFACTS_P1_V2 is ALWAYS a function */
(function(){
  'use strict';

  function stub(){
    try{ console.info("[VSP][DD] stub invoked"); }catch(_){}
    return {open:function(){},show:function(){},close:function(){},destroy:function(){}};
  }

  function lock(){
    try{
      if (typeof window === "undefined") return;

      // keep last known good real impl
      if (typeof window.__vsp_dd_real !== "function") window.__vsp_dd_real = null;

      function getFn(){
        return (typeof window.__vsp_dd_real === "function") ? window.__vsp_dd_real : stub;
      }

      // If property can be defined, lock it
      try{
        Object.defineProperty(window, "VSP_DASH_DRILLDOWN_ARTIFACTS_P1_V2", {
          configurable: false,
          enumerable: true,
          get: function(){ return getFn(); },
          set: function(v){
            if (typeof v === "function") {
              window.__vsp_dd_real = v;
              try{ console.info("[VSP][DD] accepted real drilldown impl"); }catch(_){}
            } else {
              try{ console.warn("[VSP][DD] blocked non-function overwrite:", v); }catch(_){}
            }
          }
        });
        // normalize existing value (if it was non-function)
        if (typeof window.VSP_DASH_DRILLDOWN_ARTIFACTS_P1_V2 !== "function") {
          window.__vsp_dd_real = null;
        }
      }catch(e){
        // Fallback if defineProperty fails: force-correct periodically
        try{ console.warn("[VSP][DD] defineProperty failed, fallback ticker", e); }catch(_){}
        try{
          if (!window.__vsp_dd_fix_timer) {
            window.__vsp_dd_fix_timer = setInterval(function(){
              try{
                if (typeof window.VSP_DASH_DRILLDOWN_ARTIFACTS_P1_V2 !== "function") {
                  window.VSP_DASH_DRILLDOWN_ARTIFACTS_P1_V2 = stub;
                }
              }catch(_){}
            }, 400);
          }
        }catch(_){}
      }
    }catch(_){}
  }

  // early + late lock
  lock();
  try{
    window.addEventListener("DOMContentLoaded", lock, {once:true});
    window.addEventListener("load", lock, {once:true});
  }catch(_){}
})();
